---
title: "Analiza działania algorytmów minimalizacji stochastycznej"
author:
- Patryk Klatka
- Szymon Twardosz
output: html_notebook
---

```{r, setup, echo=FALSE, message=FALSE, warning=FALSE}
# PDF Render: output: pdf_document

# NOTE: Use code below if you can't load data files
# setwd("/path/to/project/directory")

# Include libraries
library(smoof)
library(GA)
```

## Wstęp
Projekt ma na celu analizę działania algorytmów minimalizacji stochastycznej dwóch algorytmów: PRS (Pure Random Search) oraz GA (Genetic Algorithm).
Oba algorytmy były testowane na dwóch funkcjach z pakietu `smoof` z wymiarami: 2,10,20.
Każdy algorytm został uruchomiony 50 razy, a każde uruchomienie miało 1000 wywołań.
Każda funkcja była testowana na dwóch algorytmach, a wyniki zostały porównane pod kątem średnich znalezionych minimów, położenia rozkładu wyników oraz istotności statystycznej różnicy między średnim wynikiem obu algorytmów.
Analizy statystyczne zostały wykonane na poziomie istotności 0,05.

## Testowane funkcje

W celu przetestowania algorytmów zostały wybrane dwie funkcje z pakietu `smoof`: funkcja [Rosenbrocka](https://jakobbossek.github.io/smoof/reference/makeRosenbrockFunction.html) oraz [Rastrigina](https://jakobbossek.github.io/smoof/reference/makeRastriginFunction.html).
Każda funkcja została wygenerowana na trzech różnych wymiarach: 2, 10, 20.
Dziedziny funkcji, zgodnie z dokumentacją, wynoszą:

- Funkcja Rosenbrocka: $x_i \in [−30,30]$ dla $i = 1, 2, \dots, n$
- Funkcja Rastrigina: $x_i \in [−5.12,5.12]$ dla $i = 1, 2, \dots, n$

gdzie $n$ oznacza wymiar funkcji.
```{r}
# Rosenbrock function
rosenbrock_2D <- makeRosenbrockFunction(dimensions = 2L)
rosenbrock_10D <- makeRosenbrockFunction(dimensions = 10L)
rosenbrock_20D <- makeRosenbrockFunction(dimensions = 20L)

# Rastrigin function
rastrigin_2D <- makeRastriginFunction(dimensions = 2L)
rastrigin_10D <- makeRastriginFunction(dimensions = 10L)
rastrigin_20D <- makeRastriginFunction(dimensions = 20L)
```

## Stałe i funkcje pomocnicze

W celu ułatwienia analizy oraz łatwej zmiany parametrów, w tej sekcji zostały zdefiniowane stałe oraz funkcje pomocnicze.
```{r}
# Define number of calculations for each algorithm
number_of_calculations <- 50L

loadData <- function(filename) {
    #' Loads data from file
    #'
    #' @param filename Name of the file
    #' @return Returns data from file, otherwise NULL if file does not exist

  if (file.exists(filename)) {
    return(readRDS(filename))
  }else {
    return(NULL)
  }
}

saveData <- function(data, filename) {
    #' Saves data to file
    #'
    #' @param data Data to save
    #' @param filename Name of the file
    #' @return Returns data parameter

  saveRDS(data, filename)
  return(data)
}
```

## Algorytm PRS (Pure Random Search)

Opis algorytmu.

### Implementacja

```{r}
prs_algorithm <- function(f, cost = 1000L) {
    #' Pure Random Search algorithm
    #'
    #' @param f Function to minimize (from spoof package)
    #' @param cost Number of calculations
    #' @return Returns function value

  if (!isSmoofFunction(f)) {
    stop("Function is not from smoof package.")
  }

  # Generate points
  domain_min <- getLowerBoxConstraints(f)
  domain_max <- getUpperBoxConstraints(f)

  points <- matrix(0, nrow = cost, ncol = length(domain_min))
  for (i in seq_along(domain_min)){
    uniform_distribution_points <- runif(cost, domain_min[i], domain_max[i])
    for (j in seq_along(uniform_distribution_points)) {
      points[j, i] <- uniform_distribution_points[j]
    }
  }

  # Return minimum function value
  return(min(apply(points, 1, f)))
}
```
### Generacja danych oraz obliczenie średnich wyników algorytmu

Generowanie minimalnych wartości funkcji za pomocą algorytmu PRS, obliczenie średniej z wyników oraz zapisanie ich do pliku rds.
```{r}
prs_rosenbrock_2D <- loadData("./data/prs_rosenbrock_2D.rds")
if (is.null(prs_rosenbrock_2D)) prs_rosenbrock_2D <- saveData(replicate(number_of_calculations, prs_algorithm(rosenbrock_2D)), "./data/prs_rosenbrock_2D.rds")
mean_prs_rosenbrock_2D <- mean(prs_rosenbrock_2D)

prs_rosenbrock_10D <- loadData("./data/prs_rosenbrock_10D.rds")
if (is.null(prs_rosenbrock_10D)) prs_rosenbrock_10D <- saveData(replicate(number_of_calculations, prs_algorithm(rosenbrock_10D)), "./data/prs_rosenbrock_10D.rds")
mean_prs_rosenbrock_10D <- mean(prs_rosenbrock_10D)

prs_rosenbrock_20D <- loadData("./data/prs_rosenbrock_20D.rds")
if (is.null(prs_rosenbrock_20D)) prs_rosenbrock_20D <- saveData(replicate(number_of_calculations, prs_algorithm(rosenbrock_20D)), "./data/prs_rosenbrock_20D.rds")
mean_prs_rosenbrock_20D <- mean(prs_rosenbrock_20D)

prs_rastrigin_2D <- loadData("./data/prs_rastrigin_2D.rds")
if (is.null(prs_rastrigin_2D)) prs_rastrigin_2D <- saveData(replicate(number_of_calculations, prs_algorithm(rastrigin_2D)), "./data/prs_rastrigin_2D.rds")
mean_prs_rastrigin_2D <- mean(prs_rastrigin_2D)

prs_rastrigin_10D <- loadData("./data/prs_rastrigin_10D.rds")
if (is.null(prs_rastrigin_10D)) prs_rastrigin_10D <- saveData(replicate(number_of_calculations, prs_algorithm(rastrigin_10D)), "./data/prs_rastrigin_10D.rds")
mean_prs_rastrigin_10D <- mean(prs_rastrigin_10D)

prs_rastrigin_20D <- loadData("./data/prs_rastrigin_20D.rds")
if (is.null(prs_rastrigin_20D)) prs_rastrigin_20D <- saveData(replicate(number_of_calculations, prs_algorithm(rastrigin_20D)), "./data/prs_rastrigin_20D.rds")
mean_prs_rastrigin_20D <- mean(prs_rastrigin_20D)
```
## Algorytm GA (Genetic Algorithm)

Algorytm genetyczny jest algorytmem ewolucyjnym, który bazuje na zasadzie ewolucji naturalnej. Została wybrana implementacja z biblioteki `GA`, dostępnej w `CRAN`. Przy korzystaniu z funkcji z tej biblioteki należy funkcję, która ma być minimalizowana, przekształcić do postaci `f(x) = -f(x)`, ponieważ domyślnie algorytm szuka maksimum.

### Implementacja

```{r}
ga_algorithm <- function(f, cost = 1000L) {
  #' Genetic Algorithm
  #'
  #' @param f Function to minimize (from spoof package)
  #' @param cost Number of calculations
  #' @return Returns function value

  if (!isSmoofFunction(f)) {
    stop("Function is not from smoof package.")
  }

  result <- ga(type = "real-valued",
               fitness = function(x) -f(x),
               lower = getLowerBoxConstraints(f),
               upper = getUpperBoxConstraints(f),
               maxiter = cost,
               run = cost)

  return(f(result@solution))
}

```

### Generacja danych oraz obliczenie średnich wyników algorytmu

Generowanie minimalnych wartości funkcji za pomocą algorytmu GA, obliczenie średniej z wyników oraz zapisanie ich do pliku rds.

```{r}
ga_rosenbrock_2D <- loadData("./data/ga_rosenbrock_2D.rds")
if (is.null(ga_rosenbrock_2D))ga_rosenbrock_2D <- saveData(replicate(number_of_calculations, ga_algorithm(rosenbrock_2D)), "./data/ga_rosenbrock_2D.rds")
mean_ga_rosenbrock_2D <- mean(ga_rosenbrock_2D)

ga_rosenbrock_10D <- loadData("./data/ga_rosenbrock_10D.rds")
if (is.null(ga_rosenbrock_10D)) ga_rosenbrock_10D <- saveData(replicate(number_of_calculations, ga_algorithm(rosenbrock_10D)), "./data/ga_rosenbrock_10D.rds")
mean_ga_rosenbrock_10D <- mean(ga_rosenbrock_10D)

ga_rosenbrock_20D <- loadData("./data/ga_rosenbrock_20D.rds")
if (is.null(ga_rosenbrock_20D)) ga_rosenbrock_20D <- saveData(replicate(number_of_calculations, ga_algorithm(rosenbrock_20D)), "./data/ga_rosenbrock_20D.rds")
mean_ga_rosenbrock_20D <- mean(ga_rosenbrock_20D)

ga_rastrigin_2D <- loadData("./data/ga_rastrigin_2D.rds")
if (is.null(ga_rastrigin_2D)) ga_rastrigin_2D <- saveData(replicate(number_of_calculations, ga_algorithm(rastrigin_2D)), "./data/ga_rastrigin_2D.rds")
mean_ga_rastrigin_2D <- mean(ga_rastrigin_2D)

ga_rastrigin_10D <- loadData("./data/ga_rastrigin_10D.rds")
if (is.null(ga_rastrigin_10D)) ga_rastrigin_10D <- saveData(replicate(number_of_calculations, ga_algorithm(rastrigin_10D)), "./data/ga_rastrigin_10D.rds")
mean_ga_rastrigin_10D <- mean(ga_rastrigin_10D)

ga_rastrigin_20D <- loadData("./data/ga_rastrigin_20D.rds")
if (is.null(ga_rastrigin_20D)) ga_rastrigin_20D <- saveData(replicate(number_of_calculations, ga_algorithm(rastrigin_20D)), "./data/ga_rastrigin_20D.rds")
mean_ga_rastrigin_20D <- mean(ga_rastrigin_20D)
```
## Porównanie średnich wyników algorytmów oraz ich analiza pod kątem położenia i rozproszenia rozkładu


### Funkcja Rosenbrocka

#### Wymiar 2D
#### Wymiar 10D
#### Wymiar 20D

### Funkcja Rastrigina

#### Wymiar 2D
#### Wymiar 10D
#### Wymiar 20D

## Analiza istotności statystycznej różnicy między wynikami algorytmów

### Funkcja Rosenbrocka

#### Wymiar 2D
#### Wymiar 10D
#### Wymiar 20D

### Funkcja Rastrigina

#### Wymiar 2D
#### Wymiar 10D
#### Wymiar 20D